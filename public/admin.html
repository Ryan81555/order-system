<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 주문 목록</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-bg: linear-gradient(135deg, #232526 0%, #414345 100%);
      --glass-bg: rgba(255,255,255,0.13);
      --glass-blur: blur(12px);
      --primary: #4f8cff;
      --success: #43e97b;
      --warning: #ffb347;
      --danger: #ff4e50;
      --text-main: #fff;
      --text-sub: #b0b8c1;
      --card-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
      --border-glass: 1.5px solid rgba(255,255,255,0.18);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      min-height: 100vh;
    }
    body {
      font-family: 'Montserrat', 'Noto Sans KR', Arial, sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      background: var(--main-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .container {
      width: 100%;
      max-width: 540px;
      margin: 48px auto 0 auto;
      background: var(--glass-bg);
      border-radius: 32px;
      box-shadow: var(--card-shadow);
      border: var(--border-glass);
      backdrop-filter: var(--glass-blur);
      padding: 40px 28px 32px 28px;
      position: relative;
      z-index: 1;
    }
    h1 {
      text-align: center;
      font-size: 2.2em;
      font-family: 'Montserrat', 'Noto Sans KR', sans-serif;
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 18px;
      color: #fff;
      text-shadow: 0 2px 16px rgba(79,140,255,0.18);
    }
    .stats {
      text-align: center;
      font-size: 1.1em;
      margin-bottom: 28px;
      color: var(--text-sub);
      font-weight: 700;
      letter-spacing: 1px;
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 12px 0 10px 0;
      box-shadow: 0 2px 8px rgba(79,140,255,0.08);
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 28px;
      gap: 12px;
    }
    .tab {
      padding: 12px 36px;
      border-radius: 16px 16px 0 0;
      background: rgba(255,255,255,0.10);
      color: var(--text-sub);
      font-weight: 700;
      font-size: 1.1em;
      border: none;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      outline: none;
      box-shadow: 0 2px 8px rgba(79,140,255,0.04);
      letter-spacing: 1px;
    }
    .tab.active {
      background: linear-gradient(90deg, #4f8cff 0%, #43e97b 100%);
      color: #fff;
      box-shadow: 0 4px 16px rgba(79,140,255,0.18);
      transform: translateY(-2px) scale(1.04);
    }
    .order-list {
      display: flex;
      flex-direction: column;
      gap: 22px;
      min-height: 120px;
    }
    .order-card {
      background: rgba(255,255,255,0.18);
      border-radius: 18px;
      box-shadow: 0 4px 24px 0 rgba(31, 38, 135, 0.18);
      border: 1.5px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(8px);
      padding: 22px 24px 18px 24px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      position: relative;
      animation: fadeIn 0.7s cubic-bezier(.4,0,.2,1);
      transition: box-shadow 0.2s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .order-id {
      font-weight: 700;
      color: #4f8cff;
      margin-bottom: 4px;
      font-size: 1.08em;
      letter-spacing: 1px;
    }
    .order-table {
      color: #43e97b;
      margin-bottom: 4px;
      font-weight: 700;
    }
    .order-menu {
      margin-bottom: 6px;
      color: #fff;
      font-size: 1.05em;
    }
    .order-time {
      font-size: 0.98em;
      color: #b0b8c1;
      margin-bottom: 12px;
    }
    .order-card button {
      padding: 9px 22px;
      border: none;
      border-radius: 8px;
      font-size: 1.08em;
      font-weight: 700;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 4px;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(79,140,255,0.10);
      letter-spacing: 1px;
    }
    .btn-ready { background: linear-gradient(90deg, #4f8cff 0%, #43e97b 100%); color: #fff; }
    .btn-serve { background: linear-gradient(90deg, #ffb347 0%, #ff4e50 100%); color: #fff; }
    .btn-done { background: #aaa; color: #fff; cursor: default; }
    .order-card button:active { filter: brightness(0.95);}
    .order-card button:disabled { opacity: 0.7; }
    @media (max-width: 700px) {
      .container { max-width: 98vw; padding: 10px 2vw; }
      .order-card { padding: 12px 8px; }
      .tab { font-size: 1em; padding: 8px 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>주문 관리</h1>
    <div class="stats" id="stats"></div>
    <div class="tabs">
      <button class="tab active" id="tab-wait" onclick="showTab('대기')">대기</button>
      <button class="tab" id="tab-ready" onclick="showTab('준비중')">준비중</button>
      <button class="tab" id="tab-done" onclick="showTab('서빙완료')">서빙완료</button>
    </div>
    <div class="order-list" id="orderList"></div>
  </div>

  <audio id="notifySound" src="notify.mp3" preload="auto"></audio>

  <script>
    let lastOrderCount = 0;
    let firstInteraction = false;
    let allOrders = [];
    let currentTab = '대기';
    window.addEventListener('click', () => { firstInteraction = true; });

    function renderStats(orders) {
      let total = 0;
      let count = 0;
      let menuStats = {};
      orders.forEach(order => {
        if(order.status === '서빙완료') {
          order.items.forEach(item => {
            total += item.price * item.qty;
            menuStats[item.name] = (menuStats[item.name] || 0) + item.qty;
          });
          count++;
        }
      });
      let menuStr = Object.entries(menuStats).map(([name, qty]) => `${name}: ${qty}개`).join(', ');
      document.getElementById('stats').innerText = `오늘 매출: ${total.toLocaleString()}원 | 총 주문: ${orders.length}건 | ${menuStr}`;
    }

    function renderOrders() {
      const orderList = document.getElementById('orderList');
      orderList.innerHTML = '';
      const filtered = allOrders.filter(order => order.status === currentTab);
      if(filtered.length === 0) {
        orderList.innerHTML = '<div style="text-align:center;color:#b0b8c1;">주문이 없습니다.</div>';
        return;
      }
      filtered.forEach(order => {
        const card = document.createElement('div');
        card.className = 'order-card';
        card.innerHTML = `
        <div class="order-id">주문번호: ${order.id}</div>
        <div class="order-table">
          ${order.table ? `테이블: ${order.table}` : ''}
          ${order.room ? `객실: ${order.room}` : ''}
        </div>
        <div class="order-menu">${order.items.map(item => `${item.name}(${item.qty})`).join(', ')}</div>
        <div class="order-time">${new Date(order.time).toLocaleTimeString()}</div>
      `;
        if(order.status === '대기') {
          const btn = document.createElement('button');
          btn.className = 'btn-ready';
          btn.innerText = '준비중';
          btn.onclick = () => changeStatus(order.id, '준비중');
          card.appendChild(btn);
        } else if(order.status === '준비중') {
          const btn = document.createElement('button');
          btn.className = 'btn-serve';
          btn.innerText = '서빙완료';
          btn.onclick = () => changeStatus(order.id, '서빙완료');
          card.appendChild(btn);
        } else if(order.status === '서빙완료') {
          const done = document.createElement('button');
          done.className = 'btn-done';
          done.innerText = '완료';
          done.disabled = true;
          card.appendChild(done);
        }
        orderList.appendChild(card);
      });
    }

    function showTab(tab) {
      currentTab = tab;
      document.getElementById('tab-wait').classList.remove('active');
      document.getElementById('tab-ready').classList.remove('active');
      document.getElementById('tab-done').classList.remove('active');
      if(tab === '대기') document.getElementById('tab-wait').classList.add('active');
      if(tab === '준비중') document.getElementById('tab-ready').classList.add('active');
      if(tab === '서빙완료') document.getElementById('tab-done').classList.add('active');
      renderOrders();
    }

    function fetchOrders() {
      fetch('/api/orders')
        .then(res => res.json())
        .then(data => {
          allOrders = data;
          renderStats(data);
          renderOrders();
          // 새 주문 알림
          if (data.length > lastOrderCount && firstInteraction) {
            const audio = document.getElementById('notifySound');
            audio.currentTime = 0;
            audio.play().catch(e => {});
            if (window.navigator.vibrate) {
              window.navigator.vibrate(300);
            }
          }
          lastOrderCount = data.length;
        });
    }

    function changeStatus(orderId, status) {
      fetch(`/api/order/${orderId}/status`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status })
      }).then(() => fetchOrders());
    }

    setInterval(fetchOrders, 3000);
    fetchOrders();
  </script>
</body>
</html>